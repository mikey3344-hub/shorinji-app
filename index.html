<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Shorinji Kempo - Tirage Techniques</title>

  <link rel="apple-touch-icon" href="skp_icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background: #111;
      color: white;
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
    }

    .container {
      padding: 20px;
    }

    select, button, input {
      font-size: 16px;
      padding: 10px;
      margin: 8px;
      border-radius: 10px;
      border: none;
    }

    input {
      width: 80%;
      max-width: 300px;
      border: 1px solid #ccc;
    }

    button {
      background: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    .danger {
      background: #dc3545;
    }

    .danger:hover {
      background: #b02a37;
    }

    .secondary {
      background: #198754;
    }

    .secondary:hover {
      background: #146c43;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      margin-top: 20px;
    }

    .grade {
      font-size: 18px;
      font-weight: bold;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      color: white;
    }

    .technique {
      font-size: 24px;
      font-weight: bold;
      margin: 20px 0;
      text-transform: uppercase;
    }

    .history, .stats {
      margin-top: 20px;
      text-align: left;
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .history h3, .stats h3 {
      margin-top: 0;
    }

    .history ul, .stats ul {
      padding-left: 20px;
    }

    .history li, .stats li {
      margin-bottom: 6px;
    }

    .footer {
      margin-top: 20px;
      font-size: 12px;
      color: gray;
    }

    .loginBox {
      margin-top: 40px;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      max-width: 380px;
      margin-left: auto;
      margin-right: auto;
    }
  
    .watermark {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 320px;
      height: 320px;
      transform: translate(-50%, -50%);
      opacity: 0.08;
      z-index: 0;
      pointer-events: none;
      background-image: url('skp_icon.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* Keep content above watermark */
    header, .container, .loginBox, #appScreen {
      position: relative;
      z-index: 2;
    }

  </style>
</head>

<body>

<div class="watermark"></div>


<header>ü•ã Shorinji Kempo - Tirage Techniques</header>

<div class="container">

  <!-- LOGIN -->
  <div id="loginScreen" class="loginBox">
    <h2>üîí Acc√®s r√©serv√©</h2>
    <p>Entrez le mot de passe du dojo :</p>
    <input type="password" id="passwordInput" placeholder="Mot de passe">
    <br>
    <button onclick="checkPassword()">‚úÖ Valider</button>
    <p id="loginError" style="color:red; font-weight:bold;"></p>
  </div>

  <!-- APP -->
  <div id="appScreen" style="display:none;">

    <label for="gradeSelect"><b>Choisir un grade :</b></label><br>
    <select id="gradeSelect">
      <option value="ALL">Tous les grades</option>
      <option value="6EME KYU">6√®me kyu</option>
      <option value="5EME KYU">5√®me kyu</option>
      <option value="4EME KYU">4√®me kyu</option>
      <option value="3EME KYU">3√®me kyu</option>
      <option value="2EME KYU">2√®me kyu</option>
      <option value="1ER KYU">1er kyu</option>
      <option value="1ER DAN">1er dan</option>
    </select>

    <br>

    <button onclick="drawCard()">üé¥ Tirer une technique</button>
    <button onclick="toggleNoRepeat()" class="secondary" id="norepeatBtn">üîÅ Mode sans r√©p√©tition : OFF</button>
    <button onclick="resetAll()" class="danger">üóëÔ∏è Reset complet</button>

    <div class="card" id="cardDisplay" style="display:none;">
      <div class="grade" id="gradeDisplay"></div>
      <div class="technique" id="techniqueDisplay"></div>
      <button onclick="openVideo()">üì∫ Ouvrir la vid√©o</button>
    </div>

    <div class="stats">
      <h3>üìä Compteur tirages par grade</h3>
      <ul id="statsList"></ul>
    </div>

    <div class="history">
      <h3>üìå Historique (10 derniers tirages)</h3>
      <ul id="historyList"></ul>
    </div>

    <div class="footer">
      Application Shorinji Kempo - SKP Pontch√¢teau
    </div>
  </div>

</div>

<script>
  const PASSWORD = "SKP2026";
  const cards = [
  {
    "grade": "1ER DAN",
    "technique": "gedan gaeshi",
    "link": "https://youtu.be/RHbRmuwvVsI?si=fMQywizw2SBtHn4j"
  },
  {
    "grade": "1ER KYU",
    "technique": "HARAI UKE GERI",
    "link": "https://youtu.be/mhCJz9Kg8pw"
  },
  {
    "grade": "2EME KYU",
    "technique": "OKURI YUBI DORI",
    "link": "https://youtu.be/6p4kbX0CdZI"
  },
  {
    "grade": "3EME KYU",
    "technique": "ude juji gatame, tate gassho gatame",
    "link": "https://youtu.be/a9YKxqKhVwQ?si=zZ9vtXcwHi-LQwth"
  },
  {
    "grade": "4EME KYU",
    "technique": "soto uke zuki (ura, omote)",
    "link": "https://youtu.be/4A_VgRJpyiY?si=MVTE8ke-A-hRi0Dg"
  },
  {
    "grade": "5EME KYU",
    "technique": "ryusui geri (mae)",
    "link": "https://www.youtube.com/watch?v=3RYXT-dHpzc&pp=ygULcnl1c3VpIGdlcmk="
  },
  {
    "grade": "6EME KYU",
    "technique": "ryusui geri (ushiro)",
    "link": "https://youtu.be/3RYXT-dHpzc?si=8MaDlTBJNPl70YHZ"
  },
  {
    "grade": "1ER DAN",
    "technique": "gyaku tenshin geri",
    "link": "https://youtu.be/idpSspCJNMo?si=PcW9UpgxgaCwzTvV"
  },
  {
    "grade": "1ER KYU",
    "technique": "FURI Ten Ni",
    "link": "https://youtu.be/KrQmI5kznl4"
  },
  {
    "grade": "2EME KYU",
    "technique": "UCHI UKE ZUKI",
    "link": "https://youtu.be/7GWUML6SE-Y"
  },
  {
    "grade": "3EME KYU",
    "technique": "ryote yori nuki",
    "link": "https://youtu.be/aR18RbTnwOE?si=oQjyM_ptLm5jhqMD"
  },
  {
    "grade": "4EME KYU",
    "technique": "soto uke geri (ura, omote)",
    "link": "https://youtu.be/2lRbHj1A468?si=QaYvll5BGjGPHDu9"
  },
  {
    "grade": "5EME KYU",
    "technique": "uwa uke geri (omote)",
    "link": "https://youtu.be/91Bh5UIDDFo?si=4TC4X2lqqgMyF_Az"
  },
  {
    "grade": "6EME KYU",
    "technique": "uchi uke zuki (ura)",
    "link": "https://youtu.be/Lyb6g39N9tY?si=DGbfCQCFIfjQnafA"
  },
  {
    "grade": "1ER DAN",
    "technique": "gyaku tembin",
    "link": "https://youtu.be/mbXAyksIcuU?si=Y6WSEZXrLIH_HsER"
  },
  {
    "grade": "1ER KYU",
    "technique": "TSUKI Ten Ni",
    "link": "https://youtu.be/q4KjZ3ERcE4"
  },
  {
    "grade": "2EME KYU",
    "technique": "KUSSHIN ZUKI",
    "link": "https://youtu.be/z3Dual99OQo"
  },
  {
    "grade": "3EME KYU",
    "technique": "maki nuki (ryote)",
    "link": "https://youtu.be/T5a0sEIeFnY?si=rPL0XMcWK5fKHJ0W"
  },
  {
    "grade": "4EME KYU",
    "technique": "katate okuri gote,  okuri gatame",
    "link": "https://youtu.be/_qAsidOY_Fw?si=Sklnd-rP80ZKY0nY"
  },
  {
    "grade": "5EME KYU",
    "technique": "uwa uke geri (ura)",
    "link": "https://youtu.be/36jXvfKUMqk?si=RMivh0QrOluVzKkl"
  },
  {
    "grade": "6EME KYU",
    "technique": "ude juji gatame",
    "link": "https://youtu.be/a9YKxqKhVwQ?si=n0rkrtx8Crjk4rPD"
  },
  {
    "grade": "1ER DAN",
    "technique": "morote oshi nuki",
    "link": "https://youtu.be/HOqxAR90p9E?si=4jPjX4C0Io_4Br1N"
  },
  {
    "grade": "1ER KYU",
    "technique": "KERI Ten San",
    "link": "https://youtu.be/GPPa1isoBKc"
  },
  {
    "grade": "2EME KYU",
    "technique": "KUSHIN GERI",
    "link": ""
  },
  {
    "grade": "3EME KYU",
    "technique": "uchi uke geri (ura)",
    "link": "https://youtu.be/sw1KMNkAbsw?si=NS7LhwK5KKuIka6K"
  },
  {
    "grade": "4EME KYU",
    "technique": "okuri maki tembin",
    "link": "https://youtu.be/kiWhFZovfpo?si=0pR2GEz9V5ng6Puy"
  },
  {
    "grade": "5EME KYU",
    "technique": "katate yori nuki",
    "link": "https://youtu.be/d4fmlSTdRh0?si=nLBBwio7tgM2SBpr"
  },
  {
    "grade": "6EME KYU",
    "technique": "kote nuki",
    "link": "https://youtu.be/7S4iLXKTZ3M?si=P6MN0mgJYQ7DRPw_"
  },
  {
    "grade": "1ER DAN",
    "technique": "kinteki geri hiza uke nami gaeshi",
    "link": "https://youtu.be/cJ-x_sKF_pc?si=Fkd1ZYN0CNZGgzRO"
  },
  {
    "grade": "1ER KYU",
    "technique": "TSUKI Ten San",
    "link": "https://youtu.be/6bQmNCE4w54"
  },
  {
    "grade": "2EME KYU",
    "technique": "KUSHIN TSUKI GERI",
    "link": "https://youtu.be/b-yRGnsHRXY"
  },
  {
    "grade": "3EME KYU",
    "technique": "uchi uke geri (omote)",
    "link": "https://youtu.be/NGPw_VMTdQY?si=MpvEQZygyAguRBlK"
  },
  {
    "grade": "4EME KYU",
    "technique": "uchi age zuki (ura, omote)",
    "link": "https://youtu.be/c_rDJ44ifnc?si=7qDyIpAA7zyyUqLd"
  },
  {
    "grade": "5EME KYU",
    "technique": "maki nuki (katate)",
    "link": "https://youtu.be/TdwEWkuafYM?si=YqpHQmma2xtlC5y6"
  },
  {
    "grade": "6EME KYU",
    "technique": "tenshin geri",
    "link": "https://youtu.be/6neuEfjkHxA?si=dNSnCCp1tGh47rRO"
  },
  {
    "grade": "1ER DAN",
    "technique": "gyaku geri hiza uke nami gaeshi",
    "link": "https://youtu.be/HOQBK-0K8j0?si=uLeudks9jTFQDIbR"
  },
  {
    "grade": "1ER KYU",
    "technique": "TSUBAME Gaeshi",
    "link": "https://youtu.be/BaWGB3kW4TQ"
  },
  {
    "grade": "2EME KYU",
    "technique": "SOTO OSHI UKE GERI",
    "link": "https://youtu.be/soasaSCrR_I"
  },
  {
    "grade": "3EME KYU",
    "technique": "juji nuki (katate)",
    "link": "https://youtu.be/8Y7BWGD2GrQ?si=3w6gbsvGwzsayMOJ"
  },
  {
    "grade": "4EME KYU",
    "technique": "uchi age geri (ura, omote)",
    "link": "https://youtu.be/xS7yjeeQNnc?si=isWNgwPxkUdGNDIl"
  },
  {
    "grade": "5EME KYU",
    "technique": "shita uke geri",
    "link": "https://youtu.be/s6puRzO_t0I?si=XQ65eq1xyWLUZBzL"
  },
  {
    "grade": "6EME KYU",
    "technique": "uwa uke zuki (omote)",
    "link": "https://youtu.be/epXbdrgPUVg?si=z1G2mO812vgbW3vd"
  },
  {
    "grade": "1ER DAN",
    "technique": "oshi gote (katate, ryote), kannuki gatame",
    "link": "https://youtu.be/jYYb0QbChD0?si=6yIjqKV0PAz-ORpo"
  },
  {
    "grade": "1ER KYU",
    "technique": "CHIDORI Gaeshi",
    "link": "https://youtu.be/NepuDDBkH6c"
  },
  {
    "grade": "2EME KYU",
    "technique": "UCHI OSHI UKE GERI",
    "link": "https://youtu.be/EvQj4VdPpPU"
  },
  {
    "grade": "3EME KYU",
    "technique": "juji gote (katate), continued to juji gatame",
    "link": "https://youtu.be/yY9rAIGyJTY?si=_Yzx9j3VdHwt2iiw"
  },
  {
    "grade": "4EME KYU",
    "technique": "kiri nuki (soto)",
    "link": "https://youtu.be/g33PFAu5vjg?si=nyopsbxswk_jznOo"
  },
  {
    "grade": "5EME KYU",
    "technique": "shita uke jun geri",
    "link": "https://youtu.be/lt3iCrN88uU?si=9ihU-vHLoUuBG8uK"
  },
  {
    "grade": "6EME KYU",
    "technique": "uwa uke zuki (ura)",
    "link": "https://youtu.be/cjlDzsZm65o?si=lloufLcXlchGraRF"
  },
  {
    "grade": "1ER DAN",
    "technique": "kote maki gaeshi kannuki gatame",
    "link": "https://youtu.be/oPF03hkzSFE?si=ILRI2RrCVse_abm0"
  },
  {
    "grade": "1ER KYU",
    "technique": "TSUKI Nuki Morote",
    "link": "https://youtu.be/yrtakZ-49H4"
  },
  {
    "grade": "2EME KYU",
    "technique": "HAN TENSHIN GERI",
    "link": "https://youtu.be/eDRfnC2K6bo"
  },
  {
    "grade": "3EME KYU",
    "technique": "nidan nuki",
    "link": "https://youtu.be/hg7ADZ-QxSw?si=2ZQvST9p3TA6s4aC"
  },
  {
    "grade": "4EME KYU",
    "technique": "kiri nuki (uchi)",
    "link": "https://youtu.be/h3hrjpY4Cl0?si=2A9-BH3qfxgET4Xo"
  },
  {
    "grade": "5EME KYU",
    "technique": "gyaku gote, continued to mae yubi gatame",
    "link": "https://youtu.be/YSjRNBgP_sw?si=WfEXW58OKhnT3mc9"
  },
  {
    "grade": "1ER DAN",
    "technique": "morote wa nuki",
    "link": "https://youtu.be/2NmTG3M7GUk?si=hiHM8DBYg-HdR8h5"
  },
  {
    "grade": "1ER KYU",
    "technique": "OSHI Nuki Katate",
    "link": "https://youtu.be/cMa-NPSeGyU"
  },
  {
    "grade": "2EME KYU",
    "technique": "YOKO TENSHIN GERI",
    "link": "https://www.youtube.com/watch?v=wmS6pgBiJVs"
  },
  {
    "grade": "3EME KYU",
    "technique": "soto oshi uke zuki",
    "link": "https://youtu.be/SDHoxyLtLUY?si=xhi_zqmPn4wE8mAc"
  },
  {
    "grade": "4EME KYU",
    "technique": "tsuki nuki (soto)",
    "link": "https://youtu.be/x_XmoYLOIqI?si=RyxRzM75CPhVszSs"
  },
  {
    "grade": "1ER DAN",
    "technique": "morote maki nuki",
    "link": "https://youtu.be/ZmLQnGxCbbM?si=i_-aIvX5mVWXA8DL"
  },
  {
    "grade": "1ER KYU",
    "technique": "JUJI Nuki Morote",
    "link": "https://youtu.be/C_QV_mEF8Fc"
  },
  {
    "grade": "2EME KYU",
    "technique": "KON TEN ICHI",
    "link": "https://youtu.be/YurikYENETA"
  },
  {
    "grade": "3EME KYU",
    "technique": "uchi oshi uke zuki",
    "link": "https://youtu.be/ne028JWM9Ig?si=7nukejgy3RFyitWJ"
  },
  {
    "grade": "4EME KYU",
    "technique": "tsuki nuki (uchi)",
    "link": ""
  },
  {
    "grade": "1ER KYU",
    "technique": "HIKI Nuki Morote",
    "link": "https://youtu.be/dDUMspMJZIg"
  },
  {
    "grade": "2EME KYU",
    "technique": "KIRI KAESHI NUKI",
    "link": "https://youtu.be/psZSftV5qaw"
  },
  {
    "grade": "3EME KYU",
    "technique": "tsuki nuki (ryote)",
    "link": "https://youtu.be/ofXYonKDTXQ?si=rHHAd9UTuaehNCVC"
  },
  {
    "grade": "1ER KYU",
    "technique": "ERI Nuki",
    "link": "https://youtu.be/ojj9guiXwWU"
  },
  {
    "grade": "3EME KYU",
    "technique": "tsuki ten ichi",
    "link": "https://youtu.be/00T5hn3wPPQ?si=JRE11Rn3Q9HnK71O"
  },
  {
    "grade": "1ER KYU",
    "technique": "SODE Nuki",
    "link": "https://youtu.be/HcmWvs0FfVg"
  },
  {
    "grade": "2EME KYU",
    "technique": "SANKAKU NUKI",
    "link": "https://youtu.be/O0e_WHvRR9w"
  },
  {
    "grade": "3EME KYU",
    "technique": "hiji nuki, continued to mae tembin",
    "link": "https://youtu.be/yVucusXeEQ4?si=GoE3qHl2iLS9UH3b"
  },
  {
    "grade": "1ER KYU",
    "technique": "MAKI GOTE katate",
    "link": "https://youtu.be/aPer_GSF-d8"
  },
  {
    "grade": "2EME KYU",
    "technique": "JUJI NUKI",
    "link": "https://youtu.be/r799KSGnZSg"
  },
  {
    "grade": "3EME KYU",
    "technique": "gyaku gote, continued to ura gaeshi nage, ura gatame",
    "link": "https://www.youtube.com/watch?v=kBn2-i8IwEs"
  },
  {
    "grade": "1ER KYU",
    "technique": "MAKI GOTE morote",
    "link": "https://youtu.be/3Tic3fzrzSQ"
  },
  {
    "grade": "2EME KYU",
    "technique": "GASSHO NUKI",
    "link": "https://youtu.be/Mqo7eFZ_Fz4"
  },
  {
    "grade": "3EME KYU",
    "technique": "juji uke geri",
    "link": "https://youtu.be/coFGidFzzDk?si=OtvSX9uto-MjHM_b"
  },
  {
    "grade": "1ER KYU",
    "technique": "JUJI GOTE morote",
    "link": "https://youtu.be/6YCcSVajBn0"
  },
  {
    "grade": "2EME KYU",
    "technique": "JOHAKU NUKI",
    "link": "https://youtu.be/EJP5q9KTZlo"
  },
  {
    "grade": "1ER KYU",
    "technique": "TEMBIN GATAME mae",
    "link": "https://youtu.be/MhpWPW8mbjo"
  },
  {
    "grade": "1ER KYU",
    "technique": "TEMBIN GATAME Ura",
    "link": "https://youtu.be/x9am6kkPIHo"
  },
  {
    "grade": "2EME KYU",
    "technique": "OSHI KIRI NUKI",
    "link": "https://youtu.be/_LqgnuQuR7U"
  },
  {
    "grade": "1ER KYU",
    "technique": "SODE Maki",
    "link": "https://youtu.be/APuPgXKDNdM"
  },
  {
    "grade": "2EME KYU",
    "technique": "RYOUTE OKURI GOTE",
    "link": "https://youtu.be/Q05FcLODzpU"
  },
  {
    "grade": "1ER KYU",
    "technique": "SODE Dori",
    "link": "https://youtu.be/jxq8Nk4dLuo"
  },
  {
    "grade": "2EME KYU",
    "technique": "OKURI DORI",
    "link": "https://youtu.be/HkhizeSFfJw"
  },
  {
    "grade": "1ER KYU",
    "technique": "SODE Maki Tembin",
    "link": "https://youtu.be/9ZET_pgHS9c"
  },
  {
    "grade": "2EME KYU",
    "technique": "OKURI YOKO TEMBIN",
    "link": "https://youtu.be/L-1uBM5-gZE"
  },
  {
    "grade": "1ER KYU",
    "technique": "HIKI Otoshi",
    "link": "https://youtu.be/ZPgP2FBXMD0"
  },
  {
    "grade": "2EME KYU",
    "technique": "RYOTE JUJI GOTE",
    "link": "https://youtu.be/kO2vvdMDAsw"
  },
  {
    "grade": "1ER KYU",
    "technique": "KATA Muna OTOSHI",
    "link": "https://youtu.be/XRHddda7cFI"
  },
  {
    "grade": "2EME KYU",
    "technique": "RYAKU JUJI GOTE",
    "link": "https://youtu.be/ak8U6Hp8-18"
  },
  {
    "grade": "1ER KYU",
    "technique": "UDE MAKI",
    "link": "https://youtu.be/ksWfSTeh2-E"
  },
  {
    "grade": "2EME KYU",
    "technique": "MAKI JUJI GOTE",
    "link": "https://youtu.be/oLpps9WKFJc"
  },
  {
    "grade": "1ER KYU",
    "technique": "ERI JUJI",
    "link": "https://youtu.be/BuJ580H379Q"
  },
  {
    "grade": "2EME KYU",
    "technique": "KIRI GOTE",
    "link": "https://youtu.be/JD2_UtOQp_A"
  },
  {
    "grade": "2EME KYU",
    "technique": "OKURI YOUBI DORI",
    "link": "https://youtu.be/JD2_UtOQp_A"
  },
  {
    "grade": "2EME KYU",
    "technique": "JOAKU DORI",
    "link": "https://youtu.be/0cIhjH2jENQ"
  }
];

  let currentCard = null;
  let history = [];
  let noRepeatMode = false;
  let remainingPool = [];

  let stats = {
    "6EME KYU": 0,
    "5EME KYU": 0,
    "4EME KYU": 0,
    "3EME KYU": 0,
    "2EME KYU": 0,
    "1ER KYU": 0,
    "1ER DAN": 0
  };

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;

    if (input === PASSWORD) {
      localStorage.setItem("skp_auth", "ok");
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("appScreen").style.display = "block";
    } else {
      document.getElementById("loginError").innerText = "‚ùå Mot de passe incorrect";
    }
  }

  function autoLogin() {
    if (localStorage.getItem("skp_auth") === "ok") {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("appScreen").style.display = "block";
    }
  }

  function gradeColor(grade) {
    if (grade === "1ER DAN") return "#000000";
    if (grade === "1ER KYU" || grade === "2EME KYU" || grade === "3EME KYU") return "#8B4513";
    if (grade === "4EME KYU" || grade === "5EME KYU" || grade === "6EME KYU") return "#2ecc71";
    return "#444";
  }

  function getFilteredCards() {
    const selectedGrade = document.getElementById("gradeSelect").value;
    if (selectedGrade === "ALL") return cards;
    return cards.filter(c => c.grade === selectedGrade);
  }

  function initPool() {
    remainingPool = [...getFilteredCards()];
  }

  function toggleNoRepeat() {
    noRepeatMode = !noRepeatMode;
    document.getElementById("norepeatBtn").innerText =
      noRepeatMode ? "üîÅ Mode sans r√©p√©tition : ON" : "üîÅ Mode sans r√©p√©tition : OFF";

    initPool();
  }

  document.getElementById("gradeSelect").addEventListener("change", () => {
    if (noRepeatMode) initPool();
  });

  function drawCard() {
    let pool = getFilteredCards();

    if (pool.length === 0) {
      alert("Aucune technique disponible pour ce grade !");
      return;
    }

    if (noRepeatMode) {
      if (remainingPool.length === 0) {
        alert("Toutes les techniques de ce grade ont √©t√© tir√©es ! Pool r√©initialis√©.");
        initPool();
      }
      pool = remainingPool;
    }

    const randomIndex = Math.floor(Math.random() * pool.length);
    currentCard = pool[randomIndex];

    if (noRepeatMode) {
      remainingPool.splice(randomIndex, 1);
    }

    document.getElementById("cardDisplay").style.display = "block";
    document.getElementById("gradeDisplay").innerText = currentCard.grade;
    document.getElementById("gradeDisplay").style.background = gradeColor(currentCard.grade);
    document.getElementById("techniqueDisplay").innerText = currentCard.technique;

    stats[currentCard.grade]++;
    updateStats();

    history.unshift(`${currentCard.grade} - ${currentCard.technique}`);
    if (history.length > 10) history.pop();
    updateHistory();
  }

  function updateHistory() {
    const list = document.getElementById("historyList");
    list.innerHTML = "";
    history.forEach(item => {
      const li = document.createElement("li");
      li.innerText = item;
      list.appendChild(li);
    });
  }

  function updateStats() {
    const list = document.getElementById("statsList");
    list.innerHTML = "";
    for (const grade in stats) {
      const li = document.createElement("li");
      li.innerText = `${grade} : ${stats[grade]}`;
      list.appendChild(li);
    }
  }

  function resetAll() {
    if (!confirm("R√©initialiser historique + compteur + pool ?")) return;
    history = [];
    stats = {
      "6EME KYU": 0,
      "5EME KYU": 0,
      "4EME KYU": 0,
      "3EME KYU": 0,
      "2EME KYU": 0,
      "1ER KYU": 0,
      "1ER DAN": 0
    };
    initPool();
    updateHistory();
    updateStats();
  }

  function openVideo() {
    if (!currentCard || !currentCard.link) {
      alert("Aucun lien vid√©o disponible pour cette technique.");
      return;
    }
    window.open(currentCard.link, "_blank");
  }

  updateStats();
  initPool();
  autoLogin();

  document.getElementById("passwordInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter") checkPassword();
  });
</script>

</body>
</html>
